define(["jquery","core/ajax","core/notification","core/str","core/templates","core/url","core/modal_events","core/modal_factory"],function(g,c,e,f,d,b,h,a){return{debug:1,applyRules:function(k,j){var i=this;if(i.debug){console.log("local_experience/main:applyRule(level, allrules)",k,j)}g("body").removeClass("local-experience-level-0").removeClass("local-experience-level-1").addClass("local-experience-level-"+k);j.forEach(function(){if(i.debug){console.log("=> apply Rule",this)}elementstoset=this.elementstoset.split("\n");elementstoset.forEach(function(l){try{var n=l.split("=");if(n.length==2){if(typeof k!=="undefined"&&k==0){g(n[0]).val(n[1])}}}catch(m){}})})},captureKeycode:function(){document.addEventListener("keydown",function(i){console.log("pressed any key",i.key,i);if((i.ctrlKey&&i.altKey&&i.keyCode==69)||(i.ctrlKey&&i.shiftKey&&i.keyCode==69)||(i.ctrlKey&&i.keyCode==69)){console.log("Pressed edit key",i);c.call([{methodname:"local_experience_keycode",args:{action:"editmode"},done:function(j){location.reload()},fail:e.exception}])}})},detectModification:function(){var i=false;["#activity-settings-modulesettings","body #course-settings-courseadmin","body#page-question-type-multichoice","form#add_block","form#chooserform",'form[action="modedit.php"]',".bcs-new-course.backup-section",".bcs-existing-course.backup-section"].forEach(function(j){if(g(j).length>0){i=true}});if(i){g(".nav-local-experience-switch .slider").addClass("rulesapplied");g(".nav-local-experience-btn").addClass("rulesapplied");g(".local_experience_wrapper>div").addClass("rulesapplied")}},enablePanelTrigger:function(l){var j=this;if(j.debug){console.log("local_experience/main:enablePanelTrigger(level)",l)}var k=g('#nav-drawer a[data-key="experiencelevel"]').addClass("nav-local-experience-btn").attr("onclick","var c = this; require(['local_experience/main'], function(m) { m.switchExperience(!$(c).hasClass('experience-advanced')); }); return false;");var i=k.find(".media-left");if(l==1){k.addClass("experience-advanced");i.html('<i class="fa fa-icon fa-toggle-on" style="font-size: 18px;"></i>')}else{i.html('<i class="fa fa-icon fa-toggle-off" style="font-size: 18px;"></i>')}},injectText:function(){if(this.debug){console.log("local_experience/main:injectText()")}var i=["page-question-type-ddwtos","page-question-type-multianswer","page-question-type-wordselect","page-mod-bigbluebuttonbn-mod"];var j=g("body").attr("id");if(i.indexOf(j)>-1){c.call([{methodname:"local_experience_injecttext",args:{pageid:j},done:function(k){if(typeof k.text!=="undefined"&&k.text!=""){if(typeof k.appendto!=="undefined"&&k.appendto!=""){g(k.prependto).append(g("<p>").addClass("alert alert-info").html(k.text))}if(typeof k.prependto!=="undefined"&&k.prependto!=""){g(k.prependto).prepend(g("<p>").addClass("alert alert-info").html(k.text))}}},fail:e.exception}])}},switchExperience:function(k){console.log("local_experience/main:switchExperience(level)",k);k=(k)?1:0;var i=g(".nav-local-experience-btn");if(k==1){i.addClass("experience-advanced");i.find(".media-left i").removeClass("fa-toggle-off").addClass("fa-toggle-on")}else{i.removeClass("experience-advanced");i.find(".media-left i").removeClass("fa-toggle-on").addClass("fa-toggle-off")}g("body").removeClass("local-experience-level-0").removeClass("local-experience-level-1").addClass("local-experience-level-"+k);var j=this;c.call([{methodname:"local_experience_switch",args:{level:k},done:function(l){if(l==1){}},fail:e.exception}])},}});