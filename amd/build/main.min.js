define(["jquery","core/ajax","core/notification","core/str","core/templates","core/url","core/modal_events","core/modal_factory"],function(g,c,e,f,d,b,h,a){return{debug:1,applyRules:function(k,j){var i=this;if(i.debug){console.log("local_experience/main:applyRule(level, allrules)",k,j)}g("body").removeClass("local-experience-level-0").removeClass("local-experience-level-1").addClass("local-experience-level-"+k);j.forEach(function(){if(i.debug){console.log("=> apply Rule",this)}elementstoset=this.elementstoset.split("\n");elementstoset.forEach(function(l){try{var n=l.split("=");if(n.length==2){if(typeof k!=="undefined"&&k==0){g(n[0]).val(n[1])}}}catch(m){}})})},detectModification:function(){var i=false;["#activity-settings-modulesettings","body.pagelayout-incourse #course-settings-courseadmin","body#page-question-type-multichoice","form#add_block","form#chooserform",'form[action="modedit.php"]'].forEach(function(j){if(g(j).length>0){i=true}});if(i){g(".nav-local-experience-switch .slider").addClass("rulesapplied");g(".nav-local-experience-btn").addClass("rulesapplied")}},injectButton:function(k,j){var i=this;if(typeof j==="undefined"){j="#page-wrapper>.navbar>ul:last-child"}if(this.debug){console.log("local_experience/main:injectButton(level, containers)",k,j)}f.get_strings([{key:"advanced_options",component:"local_experience"},]).done(function(m){var l=g('a[data-key="experiencelevel"]').attr("href","#").addClass("nav-local-experience-btn").attr("onclick","var c = this; require(['local_experience/main'], function(m) { m.switchExperience(!$(c).hasClass('experience-advanced')); }); return false;");if(k==1){l.find(".media-left").html('<i class="fa fa-icon fa-toggle-on"></i>');l.addClass("experience-advanced")}else{l.find(".media-left").html('<i class="fa fa-icon fa-toggle-off"></i>')}l.closest("#nav-drawer").prepend(g('<nav class="list-group">').append(l));j.split("\n").forEach(function(r){if(g(o).length==0){return}var q={};var u=r.split("|");var p=0,s=1,n=2;for(var t=0;t<=2;t++){if(typeof u[t]!=="undefined"){q[t]=u[t].trim();switch(t){case n:q[t]=(u[t].trim()=="true");break}}else{q[t]=false;switch(t){case s:q[t]="append";break;case n:q[t]=true;break}}}var v=g("<div>").attr("class","nav-local-experience-switch");if(q[n]==true){v.append(g("<span>").html(m[0]+" "))}v.append(g("<label>").addClass("switch").append([g("<input>").attr("type","checkbox").attr("onclick","var c = this; require(['local_experience/main'], function(m) { m.switchExperience($(c).prop('checked')); });"),g("<span>").addClass("slider round"),]));var o=g(q[p]);if(g(o).is("ul")||g(o).is("ol")){v=g("<li>").append(v)}if(q[s]=="prepend"){g(q[p]).prepend(v)}else{g(q[p]).append(v)}});if(k==1){g(".nav-local-experience-switch input").attr("checked","checked")}i.detectModification()}).fail(e.exception)},injectText:function(){if(this.debug){console.log("local_experience/main:injectText()")}var i=["page-question-type-ddwtos","page-question-type-multianswer","page-question-type-wordselect"];var j=g("body").attr("id");if(i.indexOf(j)>-1){c.call([{methodname:"local_experience_injecttext",args:{pageid:j},done:function(k){if(typeof k.text!=="undefined"&&k.text!=""){if(typeof k.appendto!=="undefined"&&k.appendto!=""){g(k.prependto).append(g("<p>").addClass("alert alert-info").html(k.text))}if(typeof k.prependto!=="undefined"&&k.prependto!=""){g(k.prependto).prepend(g("<p>").addClass("alert alert-info").html(k.text))}}},fail:e.exception}])}},switchExperience:function(k){console.log("local_experience/main:switchExperience(level)",k);k=(k)?1:0;var i=g(".nav-local-experience-btn");if(k==1){i.addClass("experience-advanced");i.find(".media-left i").removeClass("fa-toggle-off").addClass("fa-toggle-on")}else{g(".nav-local-experience-btn").removeClass("experience-advanced");i.find(".media-left i").removeClass("fa-toggle-on").addClass("fa-toggle-off")}g(".nav-local-experience-switch input").prop("checked",k);g("body").removeClass("local-experience-level-0").removeClass("local-experience-level-1").addClass("local-experience-level-"+k);var j=this;c.call([{methodname:"local_experience_switch",args:{level:k},done:function(l){if(l==1){}},fail:e.exception}])},}});