define(["jquery","core/ajax","core/notification","core/str","core/templates","core/url","core/modal_events","core/modal_factory"],function(a,b,c,d,e,f,g,h){return{debug:1,applyRules:function(b,c){var d=this;d.debug&&console.log("local_experience/main:applyRule(level, allrules)",b,c),a("body").removeClass("local-experience-level-0").removeClass("local-experience-level-1").addClass("local-experience-level-"+b),c.forEach(function(){d.debug&&console.log("=> apply Rule",this),elementstoset=this.elementstoset.split("\n"),elementstoset.forEach(function(c){try{var d=c.split("=");2==d.length&&"undefined"!=typeof b&&0==b&&a(d[0]).val(d[1])}catch(e){}})})},injectButton:function(b,e){"undefined"==typeof e&&(e="#page-wrapper>.navbar>ul:last-child"),this.debug&&console.log("local_experience/main:injectButton(level, containers)",b,e),d.get_strings([{key:"advanced_options",component:"local_experience"}]).done(function(c){e.split("\n").forEach(function(b){for(var d={},e=b.split("|"),f=0,g=1,h=2,i=0;i<=2;i++)if("undefined"!=typeof e[i])switch(d[i]=e[i].trim(),i){case h:d[i]="true"==e[i].trim()}else switch(d[i]=!1,i){case g:d[i]="append";break;case h:d[i]=!0}var j=a("<div>").attr("class","nav-local-experience-switch");1==d[h]&&j.append(a("<span>").html(c[0]+" ")),j.append(a("<label>").addClass("switch").append([a("<input>").attr("type","checkbox").attr("onclick","var c = this; require(['local_experience/main'], function(m) { m.switchExperience($(c).prop('checked')); });"),a("<span>").addClass("slider round")]));var k=a(d[f]);(a(k).is("ul")||a(k).is("ol"))&&(j=a("<li>").append(j)),"prepend"==d[g]?a(d[f]).prepend(j):a(d[f]).append(j)}),1==b&&a(".nav-local-experience-switch input").attr("checked","checked")}).fail(c.exception)},injectText:function(){this.debug&&console.log("local_experience/main:injectText()");var d=["page-question-type-ddwtos","page-question-type-multianswer","page-question-type-wordselect"],e=a("body").attr("id");d.indexOf(e)>-1&&b.call([{methodname:"local_experience_injecttext",args:{pageid:e},done:function(b){"undefined"!=typeof b.text&&""!=b.text&&("undefined"!=typeof b.appendto&&""!=b.appendto&&a(b.prependto).append(a("<p>").addClass("alert alert-info").html(b.text)),"undefined"!=typeof b.prependto&&""!=b.prependto&&a(b.prependto).prepend(a("<p>").addClass("alert alert-info").html(b.text)))},fail:c.exception}])},switchExperience:function(d){console.log("local_experience/main:switchExperience(level)",d),a(".nav-local-experience-switch input").prop("checked",d),d=d?1:0,a("body").removeClass("local-experience-level-0").removeClass("local-experience-level-1").addClass("local-experience-level-"+d);b.call([{methodname:"local_experience_switch",args:{level:d},done:function(a){},fail:c.exception}])}}});
